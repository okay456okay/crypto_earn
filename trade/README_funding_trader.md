# Binance资金费率套利交易脚本

## 功能概述

这是一个专业的Binance合约资金费率套利交易脚本，能够自动检测负资金费率机会并执行套利策略。

## 主要特性

- ✅ **自动化执行**: 无需人工干预，全自动执行套利策略
- ✅ **风险控制**: 内置多重安全检查和风险管理机制
- ✅ **实时监控**: 详细的日志记录和状态监控
- ✅ **测试模式**: 支持沙盒环境测试，确保策略安全
- ✅ **灵活配置**: 支持命令行参数和手动时间设置

## 工作原理

1. **获取市场信息**: 获取指定合约的交易量、最大杠杆等信息
2. **监控资金费率**: 实时检查下次结算时间和当前资金费率
3. **条件判断**: 在结算前15秒检查资金费率是否小于-0.5%
4. **精准下单**: 满足条件后等待到结算前5秒执行开空单
5. **自动平仓**: 立即设置限价平仓订单
6. **风险管理**: 自动计算最优杠杆倍数和订单大小

## 安装依赖

```bash
pip install ccxt ccxtpro
```

## 配置设置

在项目根目录的 `config.py` 文件中配置您的API密钥：

```python
binance_api_key = "your_api_key_here"
binance_api_secret = "your_api_secret_here"
```

## 使用方法

### 基本用法

```bash
# 实盘交易 BTC/USDT
python binance_funding_rate_trader.py BTC/USDT

# 测试模式
python binance_funding_rate_trader.py BTC/USDT --test-mode

# 手动指定检查时间（用于测试）
python binance_funding_rate_trader.py BTC/USDT --manual-time "2024-01-01T08:00:00+00:00"

# 设置日志级别
python binance_funding_rate_trader.py BTC/USDT --log-level DEBUG
```

### 命令行参数

- `symbol`: 合约交易对符号 (必需，例如: BTC/USDT)
- `--manual-time`: 手动指定检查时间 (可选，ISO格式)
- `--test-mode`: 启用测试模式 (可选)
- `--log-level`: 设置日志级别 (可选: DEBUG, INFO, WARNING, ERROR)

## 策略参数

### 核心参数
- **资金费率阈值**: -0.5% (可在代码中修改)
- **最大杠杆倍数**: 20倍 或 交易对最大杠杆 (取较小值)
- **订单金额**: min(100 USDT, 每分钟交易量/100)
- **检查时间**: 资金费率结算前15秒
- **下单时间**: 资金费率结算前5秒

### 订单逻辑
1. **时间策略**: 结算前15秒检查条件，结算前5秒精准下单
2. **开仓**: 市价空单，杠杆 = min(20x, 最大杠杆)
3. **平仓**: 限价买单，价格 = 开仓价格 × (1 + 资金费率 - 0.5%)

## 风险管理

### 内置保护机制
- ✅ 资金费率阈值检查 (-0.5%)
- ✅ 最小订单金额限制 (10 USDT)
- ✅ 杠杆倍数限制 (最大20x)
- ✅ 订单状态验证
- ✅ 异常处理和日志记录

### 风险提示
⚠️ **重要提醒**:
- 合约交易存在爆仓风险，请确保账户有足够保证金
- 建议先在测试模式下验证策略
- 市场波动可能导致平仓订单无法及时成交
- 请根据自己的风险承受能力调整参数

## 日志文件

脚本会自动创建日志文件：
- 位置: `trade/logs/binance_funding_trader_YYYYMMDD.log`
- 包含完整的交易记录和错误信息
- 支持实时控制台输出

## 示例输出

```
2024-01-01 08:00:00 - INFO - 开始执行Binance资金费率套利策略
2024-01-01 08:00:01 - INFO - 1. 获取市场信息...
2024-01-01 08:00:01 - INFO - 24小时交易量: 1,234,567.89 USDT
2024-01-01 08:00:01 - INFO - 每分钟交易量: 856.78 USDT
2024-01-01 08:00:01 - INFO - 最大杠杆倍数: 125x
2024-01-01 08:00:02 - INFO - 2. 获取资金费率信息...
2024-01-01 08:00:02 - INFO - 当前资金费率: -0.006500 (-0.6500%)
2024-01-01 08:00:02 - INFO - 下次结算时间: 2024-01-01 08:00:00+00:00
2024-01-01 08:00:03 - INFO - 3. 等待资金费率检查时间...
2024-01-01 07:59:45 - INFO - 4. 检查资金费率条件...
2024-01-01 07:59:45 - INFO - 条件满足: 是
2024-01-01 07:59:46 - INFO - 5. 计算订单参数...
2024-01-01 07:59:46 - INFO - 杠杆倍数: 20x
2024-01-01 07:59:46 - INFO - 订单金额: 8.57 USDT
2024-01-01 07:59:47 - INFO - 7. 等待到下单时间（结算前5秒）...
2024-01-01 07:59:55 - INFO - 8. 下空单...
2024-01-01 07:59:55 - INFO - 空单下单成功: 订单ID: 123456789
2024-01-01 07:59:58 - INFO - 10. 平仓订单下单成功: 订单ID: 123456790
2024-01-01 07:59:58 - INFO - 套利策略执行完成
```

## 故障排除

### 常见问题

1. **API连接失败**
   - 检查API密钥是否正确
   - 确认网络连接和代理设置
   - 验证API权限设置

2. **资金费率获取失败**
   - 确认交易对格式正确 (BASE/QUOTE)
   - 检查交易对是否在Binance上存在

3. **下单失败**
   - 检查账户余额是否充足
   - 确认API权限包含合约交易
   - 验证订单参数是否符合交易所规则

### 调试模式

启用DEBUG日志级别获取详细信息：
```bash
python binance_funding_rate_trader.py BTC/USDT --log-level DEBUG --test-mode
```

## 免责声明

本脚本仅供教育和研究目的使用。加密货币交易存在高风险，可能导致资金损失。使用前请：

1. 充分了解资金费率套利的风险
2. 在测试环境中验证策略
3. 根据自身情况调整参数
4. 准备充足的保证金

**投资有风险，入市需谨慎！** 